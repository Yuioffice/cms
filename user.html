<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script type="text/javascript" src="js/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/index.css" >
</head>
<body>
<header>
    <div class="container">
        <nav class="navbar navbar-expand">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">重庆工程学院</a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav nav-tabs">
                        <li class="nav-item"><a class="nav-link" href="index.html"><span class="glyphicon glyphicon-home"></span>后台首页</a>
                            <div class="line"></div>
                        </li>
                        <li class="nav-item active"><a  class="nav-link" href="user.html"><span class="glyphicon glyphicon-user"></span>用户管理</a>
                            <div class="line"></div></li>
                        <li class="nav-item"><a class="nav-link" href="content.html"><span class="glyphicon glyphicon-list-alt"></span>内存管理</a>
                            <div class="line"></div></li>
                        <li class="nav-item"><a href="label.html" class="nav-link"><span class="glyphicon glyphicon-tags"></span>标签管理</a>
                            <div class="line"></div></li>
                    </ul>
                    <ul class="nav nav-tabs navbar-right">
                        <li class="nav-item dropdown">
                            <a class="dropdown-toggle nav-link" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                                admin
                            </a>
                            <ul class="dropdown-menu">
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-screenshot"></span>前台首页</a>
                                <a class="dropdown-item" href="userindex.html"><span class="glyphicon glyphicon-user"></span>个人主页</a>
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-cog"></span>个人设置</a>
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-credit-card"></span>账户中心</a>
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-star"></span>我的收藏</a>
                            </ul>
                        </li>
                        <li class="nav-item"><a href="login.html" class="nav-link"><span class="glyphicon glyphicon-off"></span>退出</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</header>
<div class="container u-manage">
     <div class="row u-border">
        <div class="u-title "> <span class="glyphicon glyphicon-grain"></span><span class="glyphicon glyphicon-grain"></span>用户管理<span class="glyphicon glyphicon-grain"></span><span class="glyphicon glyphicon-grain"></span></div>
     </div>
     <nav>
        <div class="row">
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#userlist" role="tab" aria-controls="nav-home" aria-selected="true">用户列表</a>
                <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#select-user" role="tab" aria-controls="nav-profile" aria-selected="false">用户搜索</a>
                <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#add-user" role="tab" aria-controls="nav-contact" aria-selected="false">添加用户</a>
            </div>
        </div>
    </nav>
     <div class="tab-content" id="nav-tabContent">
         <div class="tab-pane fade  show active" id="userlist" role="tabpanel" aria-labelledby="nav-home-tab">
             <div class="u-list">
             <table class="table table-striped table-hover" class="table">
                 <thead>
                 <tr class="bg-dark">
                     <th scope="col">ID</th>
                     <th scope="col">用户名</th>
                     <th scope="col">邮箱</th>
                     <th scope="col">操作</th>
                 </tr>
                 </thead>
                 <tbody id="user-list1" >

                 </tbody>
             </table>
             </div>
             <nav aria-label="Page navigation example pages">
                 <ul class="pagination" id="pages">
                     <li class="page-item">
                         <a class="page-link" href="#" aria-label="Previous">
                             <span aria-hidden="true">&laquo;</span>
                         </a>
                     </li>
                     <li class="page-item">
                         <a class="page-link" href="#" aria-label="Next">
                             <span aria-hidden="true">&raquo;</span>
                         </a>
                     </li>
                 </ul>
             </nav>
         </div>
         <div class="tab-pane fade" id="select-user" role="tabpanel" aria-labelledby="nav-profile-tab">
             <div class="foot">
                 <img src="img/userselect.png" height="600" width="1000"/>
             </div>
             <div class="u-list">
                 <div class="alert alert-primary" role="alert">
                     <p class="attention">技巧提示：</p>支付模糊搜索和匹配搜索使用*代替！
                 </div>
                 <div class="container-fluid"  style="padding: 0">
                     <form style="height:500px;">
                         <div class="form-group row">
                             <label>用户名</label>
                             <div class="col-12 input-group">
                                <input id="username" type="text" class="form-control"  placeholder="请输入用户名">
                            </div>
                         </div>
                         <div class="form-group row">
                             <label>UID</label>
                             <div class="col-12 input-group">
                                 <input id="uid" type="text" class="form-control"  placeholder="请输入UID">
                             </div>
                         </div>
                         <div class="form-group row">
                             <label>选择用户组</label>
                             <select class="form-control" id="sel" >
                                 <option value="限制会员"  class="option">限制会员</option>
                                 <option value="会员">会员</option>
                                 <option value="普通用户">普通用户</option>
                                 <option value="游客">游客</option>
                             </select>
                         </div>
                         <a id="seluser" data-toggle="tab" role="tab" style="color: white" class="btn btn-primary" onclick="selectUser()">查询</a>
                     </form>
                 </div>
             </div>
         </div>
         <div class="tab-pane fade" id="add-user" role="tabpanel" aria-labelledby="nav-contact-tab">
             <div class="img">
                 <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#adduser">添加用户</button>
                 <img src="img/adduser.png"/>
             </div>
             <div class="modal fade" id="adduser" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                 <div class="modal-dialog modal-dialog-centered" role="document">
                     <div class="modal-content">
                         <div class="modal-header">
                             <h4 class="modal-title" id="exampleModalCenterTitle">添加用户</h4>
                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                 <span aria-hidden="true">&times;</span>
                             </button>
                         </div>
                         <div class="modal-body" style="padding-bottom: 0">
                             <div class="container-fluid" style="padding: 0">
                                 <form>
                                     <div class="form-group row">
                                         <label>用户名</label>
                                         <div class="col-12 input-group">
                                             <input id="username" type="text" class="form-control"  placeholder="用户名">
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label>用户密码</label>
                                         <div class="col-12 input-group">
                                             <input id="password1" type="password" class="form-control"  placeholder="请输入用户密码">
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label>确认用户密码</label>
                                         <div class="col-12 input-group">
                                             <input id="password2" type="password" class="form-control"  placeholder="请确认输入用户密码">
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label>请输入用户邮箱</label>
                                         <div class="col-12 input-group">
                                             <input id="email" type="email" class="form-control"  placeholder="请输入用户邮箱">
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label for="exampleFormControlSelect1">选择用户组</label>
                                         <select class="form-control" id="exampleFormControlSelect1">
                                             <option class="option">限制会员</option>
                                             <option>会员</option>
                                             <option>普通用户</option>
                                             <option>游客</option>
                                         </select>
                                     </div>
                                 </form>
                             </div>
                         </div>
                         <div class="modal-footer">
                             <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                             <button type="button" class="btn btn-primary" onclick="addUser()">提交</button>
                         </div>
                     </div>
                 </div>
             </div>
         </div>
     </div>
</div>
<footer>
    <div class="container">
        <div class="text-center">
            Yui ©2019-2020
        </div>
    </div>
</footer>
<script type="text/javascript">
    let userlist =[];
    $.ajax('http://127.0.0.1:7300/mock/5eec18c6590812445c83ea5f/user',{
        success:res=>{
           userlist = res.data.userList;
            paging();
            
        }
    });
    function paging() {
        $("#user-list1").html('');
        for (let i in userlist) {
            if (i < 8) {
                $("#user-list1").append(`<tr class="bg-secondary tr">
                     <th scope="row">${userlist[i].id}</th>
                     <td>${userlist[i].username}</td>
                     <td>${userlist[i].email}</td>
                     <td>
                         <div class="btn-group" role="group">
                             <button id="btnGroupDrop1" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                 操作
                             </button>
                             <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                 <a class="dropdown-item text-center del" id="delete" onclick="del(${userlist[i].id})">删除</a>
                                 <a class="dropdown-item text-center" data-toggle="modal" data-target="#edituser" onclick="editTr(${userlist[i].id})" href="#">修改</a>
                                 <a class="dropdown-item text-center top1" id="top1">全局置顶</a>
                             </div>
                         </div>
                     </td>
                 </tr>`)
            }
        }
        var pages = Math.ceil(userlist.length / 8);
        $("#pages").html('');
        $("#pages").append(`
              <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous" onclick="Previous()">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>`);
        for (let i = 0; i < pages; i++) {
            $("#pages").append(
                `<li class="page-item"><a class="page-link" href="#" onclick="jumpPage(${i})">${i+1}</a></li>`
            );
        }
        $("#pages").append(`
              <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>`)
        $('.top1').click(function(){
            console.log(1);
            var $tr = $(this).parents("tr");
            $tr.fadeOut().fadeIn();
            $(".table").prepend($tr);
            $tr.css("color","#ed7b67");
            $tr.css("font-weight","bold");
        });
    }
    function jumpPage(index) {
        $("#user-list1").html('');
        for (let i = index * 8; i < (index * 8) + 8; i++) {
            $("#user-list1").append(`<tr class="bg-secondary tr">
                     <th scope="row">${userlist[i].id}</th>
                     <td>${userlist[i].username}</td>
                     <td>${userlist[i].email}</td>
                     <td>
                         <div class="btn-group" role="group">
                             <button id="btnGroupDrop1" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                 操作
                             </button>
                             <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                 <a class="dropdown-item text-center del" id="delete" onclick="del(${userlist[i].id})">删除</a>
                                 <a class="dropdown-item text-center" data-toggle="modal" data-target="#edituser" href="#">修改</a>
                                 <a class="dropdown-item text-center del" id="top1">全局置顶</a>
                             </div>
                         </div>
                     </td>
                 </tr>`)
        }
    }
    //删除用户
    function del(user) {
        for (let u in userlist) {
            if (userlist[u].id == user) {
                userlist.splice(u, 1);
                for (let i in userlist) {
                    $("#user-list1").append(`<tr class="bg-secondary tr">
                     <th scope="row">${userlist[i].id}</th>
                     <td>${userlist[i].username}</td>
                     <td>${userlist[i].email}</td>
                     <td>
                         <div class="btn-group" role="group">
                             <button id="btnGroupDrop1" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                 操作
                             </button>
                             <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                 <a class="dropdown-item text-center del" id="delete" onclick="del(${userlist[i].id})">删除</a>
                                 <a class="dropdown-item text-center" data-toggle="modal" data-target="#edituser" href="#">修改</a>
                             </div>
                         </div>
                     </td>
                 </tr>`
                )
                }
            }

        }
        paging();
    }
    //添加用户
    function addUser() {
        let password1 = $('#password1').val();
        let password2 = $('#password2').val();
        if (password1 ==password2){
            let adduser ={
                id:userlist.length+1,
                username:$('#username').val(),
                password:password1,
                email:$('#email').val()
            };
            userlist.push(adduser);
            console.log(adduser);
            $('#adduser').modal("hide");
        }
        else {
            alert("密码不一致")
        }
    }
    // 修改用户
    function editTr(user){
        for (let u in userlist) {
            if (userlist[u].id == user) {
                $('#userlist').append(
                    `<div class="modal fade" id="edituser" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                 <div class="modal-dialog modal-dialog-centered" role="document">
                     <div class="modal-content">
                         <div class="modal-header">
                             <h4 class="modal-title" id="exampleModalCenterTitle">修改用户</h4>
                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                 <span aria-hidden="true">&times;</span>
                             </button>
                         </div>
                         <div class="modal-body" style="padding-bottom: 0">
                             <div class="container-fluid" style="padding: 0">
                                 <form>
                                 <div class="form-group row">
                                         <label>ID</label>
                                         <div class="col-12 input-group">
                                             <input id="userid" type="text" class="form-control" value="${userlist[u].id}" readonly>
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label>用户名</label>
                                         <div class="col-12 input-group">
                                             <input id="username" type="text" class="form-control" value="${userlist[u].username}" >
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label>请输入用户邮箱</label>
                                         <div class="col-12 input-group">
                                             <input id="email" type="email" class="form-control" value="${userlist[u].email}">
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label for="exampleFormControlSelect1">选择用户组</label>
                                         <select class="form-control" id="sel">
                                             <option value="0"  class="option">限制会员</option>
                                             <option value="1">会员</option>
                                             <option value="2">普通用户</option>
                                             <option value="3">游客</option>
                                         </select>
                                     </div>
                                 </form>
                             </div>
                         </div>
                         <div class="modal-footer">
                             <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                             <button type="button" class="btn btn-primary" onclick="editTr(${userlist[u].id})">提交</button>
                         </div>
                     </div>
                 </div>
             </div>`
                );
                console.log($('#option').val());
                userlist[u].id=$('#userid').val();
                userlist[u].username=$('#username').val();
                userlist[u].email=$('#email').val();
                $('#edituser').modal("hide");
            }
            }
        paging();
    }
//    查询
function selectUser() {
    console.log($('#sel').val())
    if ($('#username').val()=='*'){
        $('#seluser').attr('href','#userlist')
    }
    // if (userlist[0].option==$('#sel').val()){
    //
    // }
}

</script>
</body>
</html>