<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>内容管理</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script type="text/javascript" src="js/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" charset="gbk" src="ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="gbk" src="ueditor/ueditor.all.min.js"> </script>
    <script type="text/javascript" charset="gbk" src="ueditor/lang/zh-cn/zh-cn.js"></script>
    <link rel="stylesheet" href="css/index.css" >
</head>
<body>
<header>
    <div class="container">
        <nav class="navbar navbar-expand">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">重庆工程学院</a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav nav-tabs">
                        <li class="nav-item"><a class="nav-link" href="index.html"><span class="glyphicon glyphicon-home"></span>后台首页</a>
                            <div class="line"></div>
                        </li>
                        <li class="nav-item"><a  class="nav-link" href="user.html"><span class="glyphicon glyphicon-user"></span>用户管理</a>
                            <div class="line"></div></li>
                        <li class="nav-item active"><a class="nav-link" href="content.html"><span class="glyphicon glyphicon-list-alt"></span>内存管理</a>
                            <div class="line"></div></li>
                        <li class="nav-item"><a href="label.html" class="nav-link"><span class="glyphicon glyphicon-tags"></span>标签管理</a>
                            <div class="line"></div></li>
                    </ul>
                    <ul class="nav nav-tabs navbar-right">
                        <li class="nav-item dropdown">
                            <a id="author" class="dropdown-toggle nav-link" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                                admin
                            </a>
                            <ul class="dropdown-menu">
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-screenshot"></span>前台首页</a>
                                <a class="dropdown-item" href="userindex.html"><span class="glyphicon glyphicon-user"></span>个人主页</a>
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-cog"></span>个人设置</a>
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-credit-card"></span>账户中心</a>
                                <a class="dropdown-item" href="#"><span class="glyphicon glyphicon-star"></span>我的收藏</a>
                            </ul>
                        </li>
                        <li class="nav-item"><a href="login.html" class="nav-link"><span class="glyphicon glyphicon-off"></span>退出</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</header>
<div class="container u-manage">
    <div class="row u-border">
        <div class="u-title "> <span class="glyphicon glyphicon-tasks"></span><span class="glyphicon glyphicon-hand-right"></span>内容管理
            <span class="glyphicon glyphicon-hand-left">
            </span><span class="glyphicon glyphicon-tasks"></span></div>
    </div>
    <nav>
        <div class="row">
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#userlist" role="tab" aria-controls="nav-home" aria-selected="true">内容管理</a>
                <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#addcontent" role="tab" aria-controls="nav-profile" aria-selected="false">添加内容</a>
            </div>
        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade  show active" id="userlist" role="tabpanel" aria-labelledby="nav-home-tab">
            <div class="u-list">
                <table  class="table table-striped table-hover">
                    <thead>
                    <tr class="bg-dark">
                        <th scope="col">文章标题</th>
                        <th scope="col">作者</th>
                        <th scope="col">发布时间</th>
                        <th scope="col">操作</th>
                    </tr>
                    </thead>
                    <tbody id="user-list1">

                    </tbody>
                </table>
            </div>
            <nav aria-label="Page navigation example pages">
                <ul class="pagination" id="pages">
                    <li class="page-item">
                        <a class="page-link" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="tab-pane fade" id="addcontent" role="tabpanel" aria-labelledby="nav-profile-tab">
            <div class="u-list">
                <div class="container-fluid" style="padding: 0">
                    <form style="height:500px;">
                        <div class="form-group row">
                            <label>标题</label>
                            <div class="col-12 input-group">
                                <input id="title" type="text" class="form-control"  placeholder="请输入标题">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label>文章内容</label>
                            <div class="col-12 input-group">
                                <script id="editor" type="text/plain" style="width: 100%;height:300px;"></script>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="addContent()">提 交</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<footer>
    <div class="container">
        <div class="text-center">
            Yui ©2019-2020
        </div>
    </div>
</footer>
<script type="text/javascript" >
    var ue = UE.getEditor('editor');
    let hotnews =[];
    $.ajax('http://127.0.0.1:7300/mock/5eec18c6590812445c83ea5f/index',{
        success:res=>{
           hotnews = res.data.news;
            paging();
        }
    });
    function paging() {
        $("#user-list1").html('');
        for (let i in hotnews) {
            if (i < 8) {
                $("#user-list1").append(`
                    <tr class="bg-secondary">
                     <th scope="row">${hotnews[i].newsTitle}</th>
                     <td>${hotnews[i].author}</td>
                     <td>${hotnews[i].newsDate}</td>
                     <td>
                         <div class="btn-group" role="group">
                             <button id="btnGroupDrop1" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                 操作
                             </button>
                             <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                             <a class="dropdown-item text-center" href="#"  data-toggle="modal" data-target="#editcontent" onclick="editTr(${hotnews[i].id})">编辑</a>
                                 <a class="dropdown-item text-center" href="#" onclick="del(${hotnews[i].id})">删除</a>
                                 <a class="dropdown-item text-center top1" href="#">全局置顶</a>
                             </div>
                         </div>
                     </td>
                 </tr>`)
            }
        }
        var pages = Math.ceil(hotnews.length / 8);
        $("#pages").html('');
        $("#pages").append(`
              <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous" onclick="Previous()">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>`);
        for (let i = 0; i < pages; i++) {
            $("#pages").append(
                `<li class="page-item"><a class="page-link" href="#" onclick="jumpPage(${i})">${i+1}</a></li>`
            );
        }
        $("#pages").append(`
              <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>`)
        $('.top1').click(function(){
            console.log(1);
            var $tr = $(this).parents("tr");
            $tr.fadeOut().fadeIn();
            $(".table").prepend($tr);
            $tr.css("color","#ed7b67");
            $tr.css("font-weight","bold");
            $tr.attr('id','toptr')
        });
    }
    function jumpPage(index) {
        $("#user-list1 tr").not($('#toptr')).remove();

        for (let i = index * 8; i < (index * 8) + 8; i++) {
            $("#user-list1").append(
                `<tr class="bg-secondary" id="tr">
                     <th scope="row">${hotnews[i].newsTitle}</th>
                     <td>${hotnews[i].author}</td>
                     <td>${hotnews[i].newsDate}</td>
                     <td>
                         <div class="btn-group" role="group">
                             <button id="btnGroupDrop1" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                 操作
                             </button>
                             <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                             <a class="dropdown-item text-center" href="#" data-target="#editcontent" onclick="editTr(${hotnews[i].id})">编辑</a>
                                 <a class="dropdown-item text-center" href="#"  data-toggle="modal" onclick="del(${hotnews[i].id})">删除</a>
                                 <a class="dropdown-item text-center top1"  href="#">全局置顶</a>
                             </div>
                         </div>
                     </td>
                 </tr>`)
        }
    }
    //删除内容
    function del(content) {
        for (let u in hotnews) {
            if (hotnews[u].id == content) {
                hotnews.splice(u, 1);
                for (let i in hotnews) {
                    $("#user-list1").append(`<tr class="bg-secondary tr">
                     <th scope="row">${hotnews[i].newsTitle}</th>
                     <td>${hotnews[i].author}</td>
                     <td>${hotnews[i].newsDate}</td>
                     <td>
                         <div class="btn-group" role="group">
                             <button id="btnGroupDrop1" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                 操作
                             </button>
                             <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                 <a class="dropdown-item text-center del" id="delete" onclick="del(${hotnews[i].id})">删除</a>
                                 <a class="dropdown-item text-center" href="#">修改</a>
                             </div>
                         </div>
                     </td>
                 </tr>`
                    )
                }
            }

        }
        paging();
    }
    //添加内容
    function addContent() {
        let today =new Date();
        month =(today.getMonth()+1);
        day =today.getDate();
        if(month<10){
            month = '0'+(today.getMonth()+1);
        }
        if(day<10){
            day = '0'+today.getDate();
        }
            let addcontent ={
                id:hotnews.length+1,
                newsTitle:$('#title').val(),
                newsContent:UE.getEditor('editor').getContentTxt(),
                author:$('#author').html(),
                newsDate:today.getFullYear()+'-'+month+'-'+day
            };
        hotnews.push(addcontent);
        paging();
        alert("添加成功！")
        }
    // 修改用户
    function editTr(content){
        for (let u in hotnews) {
            console.log(1)
            if (hotnews[u].id == content) {
                $('#userlist').append(
                    `<div class="modal fade" id="editcontent" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                 <div class="modal-dialog modal-dialog-centered" role="document">
                     <div class="modal-content">
                         <div class="modal-header">
                             <h4 class="modal-title" id="exampleModalCenterTitle">修改内容</h4>
                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                 <span aria-hidden="true">&times;</span>
                             </button>
                         </div>
                         <div class="modal-body" style="padding-bottom: 0">
                             <div class="container-fluid" style="padding: 0">
                                 <form>
                                 <div class="form-group row">
                                         <label>标题</label>
                                         <div class="col-12 input-group">
                                             <input id="newsTitle" type="text" class="form-control" value="${hotnews[u].newsTitle}">
                                         </div>
                                     </div>
                                     <div class="form-group row">
                                         <label>文章内容</label>
                                         <div class="col-12 input-group">
                                            <textarea class="form-control" id="exampleFormControlTextarea1" rows="4">${hotnews[u].newsContent}</textarea>
                                        </div>
                                     </div>
                                 </form>
                             </div>
                         </div>
                         <div class="modal-footer">
                             <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                             <button type="button" class="btn btn-primary"  data-toggle="modal"  data-target="#editcontent" onclick="editTr(${hotnews[u].id})">提交</button>
                         </div>
                     </div>
                 </div>
             </div>`
                );
                hotnews[u].newsTitle=$('#newsTitle').val();
                hotnews[u].author=$('#author').html();
                $('#editcontent').modal("hide");
            }
        }
        paging();
    }
</script>
</body>
</html>